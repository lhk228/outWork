<link rel="stylesheet" href="resource/css/popup/pop_detail.css">
<div id="POPUP_DETAIL" class="popup absolute w-screen h-full flex flex-col items-center justify-start backdrop-blur-lg">
	<div class="popup-header">
		<i class="fa-solid fa-xmark btn_popup_close z-10"></i>
		<i id="BTN_FLOW_LEFT" class="fa-solid fa-arrow-left z-10"></i>
		<span class="popup_title">작품상세정보</span>
	</div>
	<!-- popup-main : 팝업 메인영역 -->
	<div class="popup-main flex-column-start">
		<!-- detail-box : 상세정보 박스 -->
		<div class="detail-box">
			<div class="detail-header">
				<div class="item-thumb square-box" style="background-image:url('resource/images/test_thumb.jpg'); width:25%;"></div>
				<div class="item-detail">
					<p class="item-title">상품명</p>
					<p class="item-context">이우환</p>
					<p class="item-price">500,00,000 원</p>
	
				<!-- Chart code -->
				<script>
				am5.ready(function() {
				
				// Create root element
				var root = am5.Root.new("chartdiv");
				root._logo.dispose();
				
				// Set themes
				root.setThemes([
					am5themes_Animated.new(root)
				]);
				
				
				// Create chart
				var chart = root.container.children.push(am5xy.XYChart.new(root, {
					panX: true,
					panY: true,
					wheelX: "panX",
					wheelY: "zoomX",
					pinchZoomX:true
				}));
				
				chart.get("colors").set("step", 3);
				
				
				// Add cursor
				var cursor = chart.set("cursor", am5xy.XYCursor.new(root, {}));
				cursor.lineY.set("visible", false);
				
				
				// Create axes
				var xAxis = chart.xAxes.push(am5xy.DateAxis.new(root, {
					maxDeviation: 0.3,
					baseInterval: {
						timeUnit: "day",
						count: 1
					},
					renderer: am5xy.AxisRendererX.new(root, {
						fill: am5.color(0xffffff),
					}),
					tooltip: am5.Tooltip.new(root, {}),
					
				}));
				
				var yAxis = chart.yAxes.push(am5xy.ValueAxis.new(root, {
					maxDeviation: 0.3,
					renderer: am5xy.AxisRendererY.new(root, {
						fill: am5.color(0xffffff),
					})
				}));
				
				var xRenderer = xAxis.get("renderer");
				var yRenderer = yAxis.get("renderer");
				xRenderer.labels.template.setAll({fill: am5.color(0xffffff),fontSize:10});
				yRenderer.labels.template.setAll({fill: am5.color(0xffffff),fontSize:10});

				// Create series
				var series = chart.series.push(am5xy.LineSeries.new(root, {
					name: "Series 1",
					xAxis: xAxis,
					yAxis: yAxis,
					valueYField: "value",
					valueXField: "date",
					
					tooltip: am5.Tooltip.new(root, {
						labelText: "{valueY}"
					}),
				}));
				series.strokes.template.setAll({
					strokeWidth: 2,
					strokeDasharray: [3, 3]
				});
				
				series.bullets.push(function(root, series, dataItem) {  
					if (dataItem.dataContext.bullet) {    
						var container = am5.Container.new(root, {});
						var circle0 = container.children.push(am5.Circle.new(root, {
							radius: 5,
							fill: am5.color(0xD700FF)
						}));
						var circle1 = container.children.push(am5.Circle.new(root, {
							radius: 5,
							fill: am5.color(0xD700FF)
						}));
				
						circle1.animate({
							key: "radius",
							to: 20,
							duration: 1000,
							easing: am5.ease.out(am5.ease.cubic),
							loops: Infinity
						});
						circle1.animate({
							key: "opacity",
							to: 0,
							from: 1,
							duration: 1000,
							easing: am5.ease.out(am5.ease.cubic),
							loops: Infinity
						});
				
						return am5.Bullet.new(root, {
							sprite: container
						})
					}
				})
				
				// Set data
				var data = [{
					date: new Date(2023, 3, 12).getTime(),
					value: 10
				}, {
					date: new Date(2023, 3, 13).getTime(),
					value: 21
				}, {
					date: new Date(2023, 3, 14).getTime(),
					value: 56
				}, {
					date: new Date(2023, 3, 15).getTime(),
					value: 57
				}, {
					date: new Date(2023, 3, 16).getTime(),
					value: 59
				}, {
					date: new Date(2023, 3, 17).getTime(),
					value: 80
				}, {
					date: new Date(2023, 3, 18).getTime(),
					value: 90,
					bullet: true
				}]
				
				series.data.setAll(data);
				
				
				// Make stuff animate on load
				// https://www.amcharts.com/docs/v5/concepts/animations/
				series.appear(1000);
				chart.appear(1000, 100);
				
				}); // end am5.ready()
				</script>
				</div>
				<div id="chartdiv"></div>
			</div>
			<ul class="tab-menu">
				<li class="selected">종합</li>
				<li>차트상세</li>
				<li>투자 큐레이션</li>
				<li>뉴스</li>
				<li>모집현황</li>
				<li>부가정보</li>
			</ul>
			<div class="detail-main">
				<!-- 모집달성률 -->
				<div id="ITEM_PROGRESS" class="detail-flow progress-container flex-row-center" style="height:110px;" page="모집현황">
					<div class="progress-name-container" style="height:10%;">
						<p class="progress-name selected">사전공개중</p>
						<p class="progress-name">투자모집</p>
						<p class="progress-name">운영기간</p>
						<p class="progress-name">수익분배</p>
					</div>
					<div class="progress-bar-container">
						<div class="progress-bar"><span class="progress-ball"></span></div>
					</div>
					<div class="goal-rate-box">
						<p style="font-size:12px;">모집현황</p>
						<div class="goal-rate-container">
							<div class="goal-rate-bar"></div>
							<span class="goal-rate-text">0 / 50,000</span>
						</div>
					</div>
				</div>

        <div class="chart-detail" page="차트상세">
					<p class="title flex-row-start"><i class="fa-solid fa-chart-line" style="margin-right:8px;"></i>시세 차트</p>
          <script>
          am5.ready(function() {
          
          // Create root element
          var root = am5.Root.new("chartdiv2");
          root._logo.dispose();
          
          // Set themes
          root.setThemes([
            am5themes_Animated.new(root)
          ]);
          
          
          // Create chart
          var chart = root.container.children.push(am5xy.XYChart.new(root, {
            panX: true,
            panY: true,
            wheelX: "panX",
            wheelY: "zoomX",
            pinchZoomX:true
          }));
          
          chart.get("colors").set("step", 3);
          
          
          // Add cursor
          var cursor = chart.set("cursor", am5xy.XYCursor.new(root, {}));
          cursor.lineY.set("visible", false);
          
          
          // Create axes
          var xAxis = chart.xAxes.push(am5xy.DateAxis.new(root, {
            maxDeviation: 0.3,
            baseInterval: {
              timeUnit: "day",
              count: 1
            },
            renderer: am5xy.AxisRendererX.new(root, {
              fill: am5.color(0xffffff),
            }),
            tooltip: am5.Tooltip.new(root, {}),
            
          }));
          
          var yAxis = chart.yAxes.push(am5xy.ValueAxis.new(root, {
            maxDeviation: 0.3,
            renderer: am5xy.AxisRendererY.new(root, {
              fill: am5.color(0xffffff),
            })
          }));
          
          var xRenderer = xAxis.get("renderer");
          var yRenderer = yAxis.get("renderer");
          xRenderer.labels.template.setAll({fill: am5.color(0xffffff),fontSize:10});
          yRenderer.labels.template.setAll({fill: am5.color(0xffffff),fontSize:10});

          // Create series
          var series = chart.series.push(am5xy.LineSeries.new(root, {
            name: "Series 1",
            xAxis: xAxis,
            yAxis: yAxis,
            valueYField: "value",
            valueXField: "date",
            
            tooltip: am5.Tooltip.new(root, {
              labelText: "{valueY}"
            }),
          }));
          series.strokes.template.setAll({
            strokeWidth: 2,
            strokeDasharray: [3, 3]
          });
          
          series.bullets.push(function(root, series, dataItem) {  
            if (dataItem.dataContext.bullet) {    
              var container = am5.Container.new(root, {});
              var circle0 = container.children.push(am5.Circle.new(root, {
                radius: 5,
                fill: am5.color(0xD700FF)
              }));
              var circle1 = container.children.push(am5.Circle.new(root, {
                radius: 5,
                fill: am5.color(0xD700FF)
              }));
          
              circle1.animate({
                key: "radius",
                to: 20,
                duration: 1000,
                easing: am5.ease.out(am5.ease.cubic),
                loops: Infinity
              });
              circle1.animate({
                key: "opacity",
                to: 0,
                from: 1,
                duration: 1000,
                easing: am5.ease.out(am5.ease.cubic),
                loops: Infinity
              });
          
              return am5.Bullet.new(root, {
                sprite: container
              })
            }
          })
          
          // Set data
          var data = [
            {
            date: new Date(2023,3,12).getTime(),
            value: 10
          }, {
            date: new Date(2023, 4, 13).getTime(),
            value: 21
          }, {
            date: new Date(2023, 5, 14).getTime(),
            value: 56
          }, {
            date: new Date(2023, 6, 15).getTime(),
            value: 57
          }, {
            date: new Date(2023, 7, 16).getTime(),
            value: 59
          }, {
            date: new Date(2023, 8, 17).getTime(),
            value: 80
          }, {
            date: new Date(2023, 9, 18).getTime(),
            value: 90,
            bullet: true
          }
        ]
          
          console.log('data :',data[0].date);
          series.data.setAll(data);
          
          
          // Make stuff animate on load
          // https://www.amcharts.com/docs/v5/concepts/animations/
          series.appear(1000);
          chart.appear(1000, 100);
          
          }); // end am5.ready()
          </script>
          <div id="chartdiv2"></div>
        </div>

				<!-- 투자 talk -->
				<div class="detail-talk" page="투자 큐레이션">
					<p class="title flex-row-start"><i class="fa-solid fa-comments" style="margin-right:8px;"></i>투자 큐레이션</p>
					<div id="CHAT_DIALOGUE" class="flex-row-center">
						<div class="chat-room">
							<div class="chat-box p-4">
								<div class="user-thumb">
									<div class="square-box" style="background-image:url('resource/images/test_thumb.jpg')"></div>
								</div>
								<div class="chat-content">
									<div class="user-id">큐레이터</div>
									<div class="user-chat">안녕하세요</div>
									<div class="chat-timelog text-sm">19:37</div>
								</div>
							</div>
						</div>
						<div class="chat-input absolute w-full bottom-0 flex-row-center">
							<input id="INPUT_USER_CHAT" type="text" placeholder="대화내용 입력" class="p-4">
							<button id="BTN_CHAT_SUBMIT" class="btn btn_white">전송</button>
						</div>
					</div>
				</div>

				<!-- 뉴스 -->
				<div class='news-page' page="뉴스">
					<p><i class="fa-solid fa-newspaper" style="padding-right:8px;"></i>뉴스</p>
					<div class="news-box" link="https://www.sedaily.com/NewsView/22QBQKSS4B">
						<p class="news-title">2년만에 10억 껑충…'이우환 바람' 이유가 있다. - 서울경제</p>
						<p class="news-content">문화 · 스포츠 > 문화 뉴스: 한국 추상미술을 대표하는 화가 이우환(85)이 국내 생존작가 중 처음으로 경매 낙찰가 30억 원을 넘어섰다.</p>
						<p class="news-date">2021.08.25</p>
					</div>
					<div class="news-box" link="https://www.koreaittimes.com/news/articleView.html?idxno=120639">
						<p class="news-title">DB금융투자, 쿠사마 야요이, 앤디 워홀 등 유명작가 '아트컬렉션' 개최</p>
						<p class="news-content">DB금융투자가 DB알파플러스클럽(DB Alpha+ Club) 내 VIP 라운지에서 '아트컬렉션'을 개최하고 유명작가 작품 전시와 아트테크 세미나를 실시한다고 30...</p>
						<p class="news-date">2주전</p>
					</div>
					<div class="news-box" link="https://www.joongang.co.kr/bridge?cloc=joongang-marticle-returnhome">
						<p class="news-title">김환기 132억 ‘우주’가 열렸다…작품 30여점 볼 기회</p>
						<p class="news-content">최근 김환기의 그림 30여 점이 서울에서 열리는 두 전시에 같이 나왔다. 서울 영동대로 S-타워의 문화예술공간 S2A에서 열리는 '환기의 노…</p>
						<p class="news-date">20222.10.23</p>
					</div>
				</div>

				<!-- 뉴스팝업 -->
				<iframe class="news-popup" style="display:none;"></iframe>

				<div page="부가정보" style="padding:12px;">
					<p><i class="fa-solid fa-book" style="padding-right:8px;"></i>부가정보</p>
					<!-- 작가정보 -->
					<div class="detail-seller overoll-box">
						<button id="BTN_ARTIST_INFO" class="btn btn_magenta">작가정보</button>
					</div>
					
					<!-- 투자기획/설명서 -->
					<div class="detail-location overoll-box">
						<button id="BTN_FLOWCHART" class="btn btn_magenta">진행보고</button>
					</div>
					
					<!-- 위치정보 -->
					<div class="overoll-box">
						<button id="BTN_COLLAPSE" class="btn btn_magenta" >위치정보</button>
					</div>
					<div id="DIV_COLL_LOCATION" class="detail-location">
						<div id="MAP_COLL" class="kakaomap"></div>
					</div>				
				</div>

				<div class="seller-detail-box flex-column-start" style="display:none;">
					<p class="seller-name">작가명</p>
					<p class="seller-explan">설명</p>
					<button class="btn btn_magenta seller-url"><a href="" target="_blank">상세정보</a></button>
				</div>
			</div>
		</div>

		<!-- flow-box : 진행보고 박스 -->
		<div class="flow-box flex-column-start" style="display:none;">
			<div class="flow-bar-box">
				<ul class="flow-bar-container">
					<li class="flow-bar"></li>
				</ul>
			</div>

			<!-- 일지 리스트 -->
			<ul class="post-list-container">
				<li class="post-list" style="text-align: center">  
					<i id="BTN_ADD_FLOW" class="fa-solid fa-plus"></i>
				</li>
			</ul>
			
			<!-- POST_PAGE : 글 작성하기-->
			<div id="POST_PAGE" class="post-view-box hidden">
				<button></button>
				<input class="inputTitle" id="TITLE_INPUT" type="text" autocomplete="off" placeholder="제목을 입력해주세요">
				<div class="post-menu">
					<div class="inputBtnBox flex-row-start">
						<i id="BTN_IMG_UPLOAD" class="fa-solid fa-image"></i>
						<i id="BTN_VIDEO_UPLOAD" class="fa-sharp fa-solid fa-photo-film"></i>
						<i id="BTN_FILE_UPLOAD" class="fa-solid fa-file"></i>
						<p id="UPLOAD_FILE_NAME"></p>
					</div>
				</div>
				<div contenteditable="true" id="CONTEXT_INPUT" class="contextInput"></div> 
				<input type="file" id="IMG_UPLOAD" value="file name" placeholder="file name" accept="image/*" style="display: none;">
				<input type="file" id="FILE_UPLOAD" value="file name" placeholder="file name" accept=".doc,.xls,.ppt,.pdf,.hwp" style="display: none;">
				<button id="BTN_SAVE_FLOWCHART" class="btn btn_magenta w-52 mt-4 text-sm">저장하기</button>
			</div>

			<!-- POPUP_ADD_VIDEO : 동영상 추가팝업 -->
			<div id="POPUP_ADD_VIDEO" class="popup-container flex-row-center" style="display:none;">
				<div class="popup video-popup" style="">
					<div class="popup-header">동영상 추가하기 <i class="fa-solid fa-xmark btn_popup_close z-10"></i></div>
					<div class="popup-main">
						<input id="INPUT_VIDEO_LINK" type="text" placeholder="동영상 링크를 넣어주세요">
					</div>
					<div class="popup-bottom justify-end pt-0">
						<button id="BTN_VIDEO_CONFIRM" class="btn btn_magenta w-full h-full">확인</button>
					</div>
				</div>
			</div>
			<i id="BTN_WRITE_FLOW" class="fa-solid fa-pen-to-square"></i>
		</div>
	<!-- popup-main : 팝업 메인영역 END -->
	</div>
</div>

<script>
$(function() {
	//정보 채우기
	viewItemDetail();

	$(".tab-menu li").click(function(){
		$(".tab-menu li").removeClass("selected");
		$(this).addClass("selected");

		let pageName = $(this).text();

		if(pageName == '종합'){ $(`div[page]`).show(); }
		else {
			$(`div[page]`).hide();
			$(`div[page='${pageName}']`).fadeIn();
		}

	});


	// click FILE INPUT
	$('#FILE_UPLOAD').change(function(){
		var upload_fileName = $(this).val().split('\\').pop();
		g_fileArray.push(` ${event.target.value}`);
		$('#UPLOAD_FILE_NAME').text(upload_fileName);
		console.log(g_fileArray); 
	})

	// click FILE DOWNLOAD
	$("#BTN_FILE_DOWNLOAD").click(function(){
		var url = URL.createObjectURL($("#FILE_UPLOAD")[0].files[0]);
		var a = $("<a>").attr("href", url).attr("download", "file.pdf file.doc file.xls file.hwp").appendTo("body");
		a[0].click();
		a.remove()
	})

	//UPLOAD BTN CLICK : INPUT FILE CLICK
	$("#BTN_FILE_UPLOAD").click(function(){ $("#FILE_UPLOAD").click();});

	//INPUT PAGE FUNCTION
	$("#BTN_IMG_UPLOAD").click(function(){
		let inputImg = $("#IMG_UPLOAD");
		inputImg.click();
	});
	
	// IMG PREVIEW
	$("#IMG_UPLOAD").on("change", function(){
		var file = this.files[0];	
		var reader = new FileReader();
		var imgCnt = $(`#CONTEXT_INPUT img`).length;

		console.log("imgCnt:",imgCnt);
		
		reader.readAsDataURL(file);
		reader.onload = function(e){
			$('#CONTEXT_INPUT').append(`<img class="contextImg" style="width:40%" src='${e.target.result}' alt=''>`);
			g_recentImgSrc.push(e.target.result);
		}
	});
	

	// click IMG INPUT	
	$('#IMG_UPLOAD').change(function() {
		var upload_imgName = $(this).val().split('\\').pop();
		$('#UPLOAD_IMG_NAME').text(upload_imgName); 
		$("#IMAGE_PREVIEW").removeClass("imgNone")
		g_imgArray.push(` ${event.target.value}`);
		// $('#IMG_ARRAY_TEXT').text(`${imgArray}`)
		console.log(g_imgArray);
		
	});

	//click VIDEO UPLOAD

	//영상추가버튼 클릭 : 영상추가팝업
	$("#BTN_VIDEO_UPLOAD").click(function(){
		var popup = $("#POPUP_ADD_VIDEO");
		popup.show();
	});

	//영상추가팝업 닫기
	$("#POPUP_ADD_VIDEO .btn_popup_close").click(function(){
		$("#POPUP_ADD_VIDEO").fadeOut();
		return false;
	});

	//동영상링크 확인버튼 : 본문에 영상삽입
	$("#BTN_VIDEO_CONFIRM").click(function(){

		let link = $("#INPUT_VIDEO_LINK").val();

		//영상목록에 링크추가
		g_videoArray.push(` ${link}`)
		console.log("videoArray :",g_videoArray);

		$("#INPUT_VIDEO_LINK").val('')
		$("#CONTEXT_INPUT").append(`${link}`)
		$("#POPUP_ADD_VIDEO").fadeOut();
	})

});

	goalRateBarControl(); //상품 모집달성률

	var mapContainer = document.getElementById('MAP_COLL'), // 지도를 표시할 div 
		mapOption = { 
				center: new kakao.maps.LatLng(33.450701, 126.570667), // 지도의 중심좌표
				level: 3 // 지도의 확대 레벨
		};

	// 지도를 표시할 div와  지도 옵션으로  지도를 생성합니다
	var map = new kakao.maps.Map(mapContainer, mapOption); 
	
</script>
